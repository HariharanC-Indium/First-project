This is the new main code
